openapi: 3.0.3
info:
  title: World Storage Service API
  version: 1.0.0
  description: |
    ## Overview

    World Storage Service provides world-isolated key-value storage. All requests
    must be signed using Decentraland's Signed Fetch (ADR-44); the calling world
    is derived from the signed fetch metadata.

  contact:
    name: Decentraland Foundation
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:3000
    description: Local development server

tags:
  - name: World Storage
    description: Endpoints for world-scoped storage

security:
  - SignedFetch: []

paths:
  /storage/world/{key}:
    get:
      tags:
        - World Storage
      summary: Get a world storage value
      description: |
        Retrieves the value stored under `key` for the calling world.
        The world identifier is resolved from the Signed Fetch metadata.
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Value found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorldStorageValueResponse'
        '400':
          description: Signed fetch is missing or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                signedFetchRequired:
                  value:
                    error: Invalid Auth Chain
                    message: This endpoint requires a signed fetch request. See ADR-44.
        '404':
          description: Value not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags:
        - World Storage
      summary: Upsert a world storage value
      description: |
        Creates or updates the value stored under `key` for the calling world.
        The world identifier is resolved from the Signed Fetch metadata.
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpsertWorldStorageRequest'
            examples:
              upsertValue:
                value:
                  value:
                    foo: bar
      responses:
        '200':
          description: Value upserted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorldStorageValueResponse'
        '400':
          description: Invalid signed fetch or request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                signedFetchRequired:
                  value:
                    error: Invalid Auth Chain
                    message: This endpoint requires a signed fetch request. See ADR-44.
                invalidJson:
                  value:
                    message: Request body must be valid JSON
                missingValue:
                  value:
                    message: Value is required
        '500':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - World Storage
      summary: Delete a world storage value
      description: |
        Deletes the value stored under `key` for the calling world.
        The world identifier is resolved from the Signed Fetch metadata.
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Deleted (or did not exist)
        '400':
          description: Signed fetch is missing or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                signedFetchRequired:
                  value:
                    error: Invalid Auth Chain
                    message: This endpoint requires a signed fetch request. See ADR-44.
        '500':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    SignedFetch:
      type: apiKey
      in: header
      name: X-Identity-Auth-Chain-*
      description: |
        Signed fetch authentication using Decentraland's ADR-44 specification.
        Multiple headers are used to provide the authentication chain.
  schemas:
    WorldStorageValueResponse:
      type: object
      properties:
        value: {}
      required:
        - value
      description: Stored value for the given world and key.
    UpsertWorldStorageRequest:
      type: object
      properties:
        value: {}
      required:
        - value
      description: Payload to persist under the provided key.
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        error:
          type: string
          description: Optional error code or cause when available.
      required:
        - message
      description: Error response body.
